/* moas-assetrequest | Fri Jul 22 2016 13:44:47 GMT+0100 (BST) */
!function(w,d,$){var assetRequest={itemId:null,downloadToken:null,initialise:function(item_id){var self=this;self.itemId=item_id,$(".js-use").on("click",function(){self._toggleModal("open")}),$(".js-close-modal").on("click",function(){self._toggleModal("close")}),$(document).keyup(function(e){27==e.keyCode&&self._toggleModal("close")}),$(".js-modal-content").on("click",function(e){e.stopPropagation()}),$("#use-resource-form").submit(function(e){e.preventDefault(),self.submitRequest()}),this._setupHashDetection(),this._setupTermsAndConditions()},submitRequest:function(){var self=this;if(this._validateRequest()){var formData=$("#use-resource-form").serialize();$.post("/asset/"+this.itemId,formData,function(data,textStatus,xhr){void 0!==data.fields&&(null!==data.fields.download_token?($(".useresource__form").toggleClass("visually-hidden"),$(".useresource__download").toggleClass("visually-hidden"),self.downloadToken=data.fields.download_token,$("#download-resource-form").attr("action","/asset/download/"+self.downloadToken)):($(".useresource__form").toggleClass("visually-hidden"),$(".useresource__contact").toggleClass("visually-hidden")))})}},_validateRequest:function(){var formErrors=!(""!==$("#requester_name").val()&&""!==$("#requester_org").val()&&"0"!==$("#requester_org_type option:selected").val()),acceptTerms=!!$("#accept_terms").prop("checked");return $(".js-form-error").hide(),$(".js-terms-error").hide(),formErrors&&$(".js-form-error").slideDown(200,"easeInOutCubic"),acceptTerms||$(".js-terms-error").slideDown(200,"easeInOutCubic"),!(formErrors&&!acceptTerms)},_setupHashDetection:function(){var self=this;"#use-this-resource"===window.location.hash&&this._toggleModal("open"),$(window).on("hashchange",function(){"#use-this-resource"==window.location.hash?self._toggleModal("open"):self._toggleModal("close")})},_setupTermsAndConditions:function(){$(".js-show-terms").on("click",function(e){return e.preventDefault(),$(".js-terms").slideToggle(200,"easeInOutCubic"),!1})},_toggleModal:function(action){"open"===action?($("body").addClass("modal-open"),window.location.hash="#use-this-resource"):"close"===action&&($("body").removeClass("modal-open"),window.location.hash="",$("#use-resource-form")[0].reset())}};$(assetRequest.initialise(w.item_id))}(window,document,window.jQuery);